### XSS 跨站脚本攻击

XSS：跨站脚本攻击是通过注入非法的html标签或者JavaScript代码，在用户浏览网页的时候控制用户浏览器。

##### XSS分类

1. 存储型XSS

攻击者将恶意的代码提交到服务器的数据库，当用户访问网页时，服务器返回这段恶意的代码给用户并在网页上执行。经典的例子就是留言板。

2. 反射型XSS

发出请求时，XSS代码出现在url中，最后输入提交到服务器，服务器解析后在响应内容中出现这段代码，最后浏览器解析并执行。通常通过用户点击恶意链接实现。


3. DOM XSS

基于DOM的XSS攻击都是在浏览器端完成，不需要经过服务器端，因此这完全是属于前端的安全漏洞。攻击者可以通过各种手段将恶意脚本注入到用户页面中。比如通过网络劫持在页面传输过程中修改页面内容。

##### XSS的危害

1. 通过`document.cookie`窃取用户的cookie信息，发送给恶意服务器，这样攻击者就能在其他电脑模拟用户登录
2. 通过`addEventListener`来监听用户行为
3. 修改用户输入表单，骗取用户个人信息
4. 显示虚假文章和图片，如浮窗显示广告

XSS相当于可以控制整个网页的前端展示，能够做非常多有害的操作。

##### XSS防御

1. 服务器配置`HttpOnly`属性，禁止前端脚本读取服务器返回的cookie
2. 对用户输入内容进行过滤或转码。如htmlEncode和JavascriptEncode
3. 充分利用CSP(Content-Security-Policy, 内容安全策略)，禁止页面执行未授权脚本、禁止向第三方域提交数据以及限制加载其他域的资源文件等

### CSRF攻击

跨站请求伪造（Cross-Site Request Forgeries），冒充用户（在用户不知情下）发起请求，完成一些违背用户意愿的事情。

##### CSRF的发起

![](https://user-gold-cdn.xitu.io/2017/10/11/ea16ef6642f4e35b5beca485a8847781?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

核心是让用户在浏览和登录信任的网站A后，在没有登出的情况下，诱导访问第三站点时发出一个网站A的请求，并带上用户的cookie，达到模拟用户操作的目的


##### CSRF的危害

利用已登录的用户身份随意更改用户的信息、购买商品以及发表信息等。

##### CSRF 防御

1. 验证码，强制要求用户进行验证，但用户体验较差
2. 利用cookie的samesite属性
    - strict禁止第三方cookie
    - lax相对宽松点，B网站的表单提交和打开A网站的链接都会带上cookie，post和img等请求则不会
    - node就是不做限制
3. 验证请求的来源站点，即验证请求头中referer或origin的属性判断是否是源站点
4. csrf token，实现思路：
    - 后端随机产生一个token，并保存到session中，同时把token交给前端页面
    - 前端请求时，把token加入到请求头或请求体中，一起传给后端
    - 后端验证前端发来的token是否和session中的一致

若网站同时存在XSS漏洞的时候，第四个方法也是空谈。

### Clickjacking 点击劫持

点击劫持是指利用透明按钮或链接做陷阱，覆盖在web页面之上，然后诱导用户在不知情下，点击链接访问内容的一种攻击手段，这种行为也叫界面伪装。

##### 点击劫持防御

1. 服务器设置 `X-FRAME-OPTIONS`
    - DENY 禁止页面被iframe引用，即使同域也不行
    - SAMEORIGIN 只允许同域名页面中的iframe引用
    - ALLOW-FROM 只允许白名单中的域名页面使用iframe引用
